## 总体目标
- 增加个人中心页面与功能
- 在每日打卡与饮食管理页面下方新增历史记录列表（仅查看）
- 将仪表盘改为首页概览，补充更多图表
- 引入管理员角色与权限控制
- 管理员仪表盘聚合多用户健康数据，异常告警
- 管理员后台进行用户信息管理（检索、分页、编辑、删除）
- 管理员定义系统默认打卡项目与提醒模板

## 数据结构与权限
- 用户表 `sys_user`：新增字段 `role`（enum: ADMIN/USER），初始化内置管理员账号（如 username: admin, password: 123456，role: ADMIN）。
- 打卡任务表 `check_in_task`：保留现有字段；新增系统默认任务表 `check_in_task_template`（管理员维护）。
- 提醒模板表 `reminder_template`：包含模板名称、内容、触发条件、建议提醒时间等（管理员维护）。
- 权限控制：
  - 后端通过请求头中的用户信息或登录返回的 `user.role` 来判定权限
  - 在控制器方法上增加简单的角色校验（管理员接口仅 ADMIN 可用）

## 后端改造
### 1. 登录与会话
- `POST /api/user/login`：返回 `role` 字段
- `POST /api/user/register`：仅创建 `USER` 角色；`ADMIN` 固定由初始化脚本或迁移创建，不开放注册

### 2. 个人中心接口
- `GET /api/user/profile?userId=...`：返回用户基础信息与近期统计（最近7天的健康数据摘要）
- `PUT /api/user/profile`：更新 `nickname`、密码（可选）

### 3. 打卡历史
- `GET /api/checkin/history?userId=...&page=1&pageSize=10&startDate&endDate`：分页返回历史打卡记录（`check_in_record`），按日期倒序

### 4. 饮食历史
- `GET /api/diet/history?userId=...&page=1&pageSize=10&startDate&endDate`：分页返回饮食记录（`diet_record`），按日期倒序

### 5. 首页概览与图表
- `GET /api/dashboard/overview?userId=...`：返回今日/最近7天/30天关键指标聚合（步数、体重、收缩压、饮食卡路里总计等）
- `GET /api/dashboard/trend?userId=...&days=7|30`：符合前端图表的数据结构（日期序列 + 指标序列）

### 6. 管理员仪表盘
- `GET /api/admin/dashboard/overview`：全局用户健康指标的聚合概览
- `GET /api/admin/dashboard/trend?metric=weight|bp|steps&days=30`：按指标输出总趋势与Top异常列表
- 异常告警逻辑：
  - 简单规则：心率>100、收缩压>140、体重单日波动>3% 等，返回告警列表

### 7. 管理员用户管理
- `GET /api/admin/users?keyword=&page=&pageSize=`：关键词检索 + 分页
- `PUT /api/admin/users/{id}`：编辑用户（昵称、密码）
- `DELETE /api/admin/users/{id}`：删除用户

### 8. 管理员系统默认打卡项目与提醒模板
- 任务模板：
  - `GET /api/admin/task-templates`、`POST /api/admin/task-templates`、`PUT /api/admin/task-templates/{id}`、`DELETE /api/admin/task-templates/{id}`
  - 新用户可从模板一键初始化个人任务：`POST /api/admin/task-templates/apply?userId=...`
- 提醒模板：
  - `GET /api/admin/reminders`、`POST /api/admin/reminders`、`PUT /api/admin/reminders/{id}`、`DELETE /api/admin/reminders/{id}`

## 前端改造
### 1. 路由与角色守卫
- 路由新增：`/profile`（个人中心）、`/admin`（后台系统，含仪表盘与用户管理、模板管理）
- 路由守卫：根据 `localStorage.user.role` 控制访问；普通用户不可进入 `/admin`

### 2. 个人中心页面
- 展示：基础信息（用户名、昵称）、近期健康摘要卡片、密码修改（可选）
- 接口：`/api/user/profile` 读取与更新

### 3. 每日打卡页面追加历史列表
- 在原打卡功能下方增加历史列表（表格或时间线），提供日期筛选与分页，仅查看
- 接口：`/api/checkin/history`

### 4. 饮食管理页面追加历史列表
- 在原功能下方增加历史饮食列表（表格），按日期筛选与分页，仅查看
- 接口：`/api/diet/history`

### 5. 首页概览（仪表盘）
- 卡片：今日步数、体重、血压、饮食卡路里等
- 图表：
  - 折线图：体重、收缩压 7/30 天趋势（已部分实现，统一接口）
  - 柱状图：近7天卡路里总量
  - 饼图：当日饮食类型占比
- 接口：`/api/dashboard/overview`、`/api/dashboard/trend`

### 6. 管理员仪表盘
- 图表：
  - 全局指标趋势：体重/血压/步数（可切换指标）
  - Top 健康异常用户列表（带简单告警规则）
- 接口：`/api/admin/dashboard/*`

### 7. 管理员后台——用户管理
- 列表：检索、分页、查看、编辑、删除
- 表单：编辑弹窗（昵称、密码）
- 接口：`/api/admin/users`、`PUT/DELETE`

### 8. 管理员后台——任务模板与提醒模板
- 任务模板：列表 + 新增/编辑/删除 + 应用到某用户
- 提醒模板：列表 + 新增/编辑/删除

## 安全与规范
- 简化权限：前端基于 `role` 控制，后端接口增加角色校验（如在控制器入口校验 `ADMIN`）
- 数据校验：分页参数与日期参数校验（默认值与范围）
- 字符编码：继续使用 UTF-8（已修复）

## 交付节奏
- 第一阶段：用户侧：个人中心、历史列表、统一仪表盘接口
- 第二阶段：管理员侧：仪表盘聚合与告警、用户管理
- 第三阶段：模板系统：任务模板与提醒模板

请确认以上方案。确认后我将开始按阶段实施，并在每阶段完成后进行可视化验证与说明。